var Brickrouge={Utils:{Busy:new Class({startBusy:function(){if(++this.busyNest==1)return;this.element.addClass("busy")},finishBusy:function(){if(--this.busyNest)return;this.element.removeClass("busy")}})},updateAssets:function(){var a=null,b=null;return function(c,d){var e=new Array,f=new Array,g;a===null&&(a=new Array,typeof document_cached_css_assets!="undefined"&&(a=document_cached_css_assets),document.id(document.head).getElements('link[type="text/css"]').each(function(b){a.push(b.get("href"))})),b===null&&(b=new Array,typeof brickrouge_cached_js_assets!="undefined"&&(b=brickrouge_cached_js_assets),document.id(document.html).getElements("script").each(function(a){var c=a.get("src");c&&b.push(c)})),c.css.each(function(b){if(a.indexOf(b)!=-1)return;e.push(b)}),e.each(function(b){new Asset.css(b),a.push(b)}),c.js.each(function(a){if(b.indexOf(a)!=-1)return;f.push(a)}),g=f.length;if(!g){d();return}f.each(function(a){new Asset.javascript(a,{onload:function(){b.push(a),--g||d()}})})}}(),Widget:{},awakeWidgets:function(a){a=a||document.id(document.body),Object.each(Brickrouge.Widget,function(b,c){var d=".widget"+c.hyphenate();a.getElements(d).each(function(a){if(a.retrieve("widget"))return;var c=new b(a,a.get("dataset"));a.store("widget",c)})})}};Request.API&&(Request.Element=new Class({Extends:Request.API,onSuccess:function(a,b){var c=Elements.from(a.rc).shift();if(!a.assets){this.parent(c,a,b);return}Brickrouge.updateAssets(a.assets,function(){this.fireEvent("complete",[a,b]).fireEvent("success",[c,a,b]).callChain()}.bind(this))}}),Request.Widget=new Class({Extends:Request.Element,initialize:function(a,b,c){c==undefined&&(c={}),c.url="widgets/"+a,c.onSuccess=b,this.parent(c)}})),Element.Properties.widget={get:function(){var a=this.retrieve("widget"),b,c,d;if(!a){b=this.className.match(/widget(-\S+)/);if(b&&b.length){c=b[1].camelCase(),d=Brickrouge.Widget[c];if(!d)throw'Constructor "'+d+'"is not defined to create widgets of type "'+b+'"';a=new d(this,this.get("dataset")),this.store("widget",a)}}return a}},Element.Properties.dataset={get:function(){var a={},b=this.attributes,c,d;for(c=0,y=b.length;c<y;c++){d=b[c];if(!d.name.match(/^data-/))continue;a[d.name.substring(5).camelCase()]=d.value}return a}},document.addEvent("elementsready",function(a){Brickrouge.awakeWidgets(a.target)}),window.addEvent("domready",function(){document.fireEvent("elementsready",{target:document.id(document.body)})}),document.id(document.body).addEvent("click:relay(div.alert-message a.close)",function(a,b){a.stop();var c=b.getParent("form");c&&c.getElements(".error").removeClass("error"),b.getParent("div.alert-message").destroy()}),Brickrouge.Form=new Class({Implements:[Options,Events],options:{url:null,useXHR:!1},initialize:function(a,b){this.element=document.id(a),this.setOptions(b),(this.options.useXHR||b&&(b.onRequest||b.onComplete||b.onFailure||b.onSuccess))&&this.element.addEvent("submit",function(a){a.stop(),this.submit()}.bind(this))},alert:function(a,b){var c,d=this.element.getElement("div.alert-"+b)||new Element("div.alert.alert-"+b,{html:'<a href="#close" class="close">Ã—</a>'});typeOf(a)=="string"?a=[a]:typeOf(a)=="object"&&(c=a,a=[],Object.each(c,function(b,c){if(typeOf(c)=="string"&&c!="_base"){var d,e,f=this.element.elements[c],g;if(typeOf(f)=="collection"){d=f[0].getParent("div.radio-group"),e=d.getParent(".field");if(d)d.addClass("error");else for(g=0,j=f.length;g<j;g++)f[g].addClass("error")}else f.addClass("error"),e=f.getParent(".field");e&&e.addClass("error")}if(!b||b===!0)return;a.push(b)},this));if(!a.length)return;a.each(function(a){d.adopt(new Element("p",{html:a}))}),d.parentNode||d.inject(this.element,"top")},clearAlert:function(){var a=this.element.getElements("div.alert");a&&a.destroy(),this.element.getElements(".error").removeClass("error")},submit:function(){this.fireEvent("submit",{}),this.getOperation().send(this.element)},getOperation:function(){return this.operation?this.operation:this.operation=new Request.JSON({url:this.options.url||this.element.action,onRequest:this.request.bind(this),onComplete:this.complete.bind(this),onSuccess:this.success.bind(this),onFailure:this.failure.bind(this)})},request:function(){this.clearAlert(),this.fireEvent("request",arguments)},complete:function(){this.fireEvent("complete",arguments)},success:function(a){a.success&&this.alert(a.success,"success"),this.onSuccess(a)},onSuccess:function(a){this.fireEvent("complete",arguments).fireEvent("success",arguments).callChain()},failure:function(a){var b=JSON.decode(a.responseText);b&&b.errors&&this.alert(b.errors,"error"),this.fireEvent("failure",arguments)}}),document.id(document.body).addEvent("click:relay(.alert a.close)",function(a,b){a.stop();var c=b.getParent("form");c&&c.getElements(".error").removeClass("error"),b.getParent(".alert").destroy()}),!function(){function b(){$$(a).getParent().removeClass("open")}function c(){var a=this.get("data-target")||this.get("href"),c=document.id(a)||this.getParent(),d;return d=c.hasClass("open"),b(),!d&&c.toggleClass("open"),!1}var a='[data-toggle="dropdown"]';window.addEvent("click",b),window.addEvent("click:relay("+a+")",function(a,b){a.stop(),c.bind(b)()})}(),Brickrouge.Popover=new Class({Implements:[Events,Options],options:{anchor:null,placement:null,visible:!1,fitContent:!1,iframe:null},initialize:function(a,b){this.element=$(a),this.setOptions(b),this.arrow=this.element.getElement(".arrow"),this.actions=this.element.getElement(".popover-actions"),this.repositionCallback=this.reposition.bind(this,!1),this.quickRepositionCallback=this.reposition.bind(this,!0),this.iframe=this.options.iframe,this.options.anchor&&this.attachAnchor(this.options.anchor),this.tween=null,this.options.animate&&(this.tween=new Fx.Tween(this.element,{property:"opacity",link:"cancel",duration:"short"})),this.options.fitContent&&this.element.addClass("fit-content"),this.element.addEvent("click",this.onClick.bind(this)),this.options.visible&&this.show()},attachAnchor:function(a){this.anchor=$(a),this.anchor||(this.anchor=$(document.body).getElement(a))},onClick:function(a){var b=a.target;b.tagName=="BUTTON"&&b.getParent(".popover-actions")&&this.fireAction({action:b.get("data-action"),popover:this,ev:a})},fireAction:function(a){this.fireEvent("action",arguments)},changePlacement:function(a){this.element.removeClass("before"),this.element.removeClass("after"),this.element.removeClass("above"),this.element.removeClass("below"),this.element.addClass(a)},show:function(){this.element.setStyles({display:"block",visibility:"hidden"}),window.addEvents({load:this.quickRepositionCallback,resize:this.quickRepositionCallback,scroll:this.repositionCallback}),this.iframe&&$(this.iframe.contentWindow).addEvents({load:this.quickRepositionCallback,resize:this.quickRepositionCallback,scroll:this.repositionCallback}),this.reposition(!0),this.options.animate?(this.tween.set(0),this.element.setStyle("visibility","visible"),this.tween.start(1)):this.element.setStyle("visibility","visible")},hide:function(){window.removeEvent("load",this.quickRepositionCallback),window.removeEvent("resize",this.quickRepositionCallback),window.removeEvent("scroll",this.repositionCallback);if(this.iframe){var a=$(this.iframe.contentWindow);a.removeEvent("load",this.quickRepositionCallback),a.removeEvent("resize",this.quickRepositionCallback),a.removeEvent("scroll",this.repositionCallback)}this.options.animate?this.tween.start(0).chain(function(){this.element.setStyle("display","")}):this.element.setStyle("display","")},computeAnchorBox:function(){var a=this.anchor,b,c=this.iframe,d,e,f,g,h,i;return c?(d=c.getCoordinates(),e=c.contentDocument.documentElement,aX=a.offsetLeft,aY=a.offsetTop,aW=a.offsetWidth,aH=a.offsetHeight,f=e.clientHeight,h=e.scrollTop,aY-=h,aY<0&&(aH+=aY),aY=Math.max(aY,0),aH=Math.min(aH,f),g=e.clientWidth,i=e.scrollLeft,aX-=i,aX<0&&(aW+=aX),aX=Math.max(aX,0),aW=Math.min(aW,g),aX+=d.left,aY+=d.top):(b=a.getCoordinates(),aX=b.left,aY=b.top,aH=b.height,aW=b.width),{x:aX,y:aY,w:aW,h:aH}},computeBestPlacement:function(a,b,c){function k(){return f+1>b+j*2}function l(){return e-(f+1+h)>b+j*2}function m(){return g+1>c+j*2}var d=document.body.parentNode,e=d.scrollWidth,f=a.x,g=a.y,h=a.w,i,j=20;i=this.options.placement;switch(i){case"after":if(l())return i;break;case"before":if(k())return i;break;case"above":if(m())return i;break;case"below":return i}return l()?"after":k()?"before":m()?"above":"below"},reposition:function(a){if(!this.anchor)return;a===undefined&&(a=this.element.getStyle("visibility")!="visible");var b=20,c=this.actions,d,e,f,g,h,i,j,k=this.element.getSize(),l=k.x,m=k.y,n,o,p,q=document.id(document.body),r=q.getSize(),s=q.getScroll(),t=s.x,u=s.y,v=r.x,w=r.y,x={top:null,left:null},y,z;d=this.computeAnchorBox(),e=d.x,f=d.y,g=d.w,h=d.h,i=e+g/2-1,j=f+h/2-1,p=this.computeBestPlacement(d,l,m),this.changePlacement(p),p=="before"||p=="after"?(o=Math.round(f+(h-m)/2-1),n=p=="before"?e-l+1:e+g-1,n=n.limit(t+b-1,t+v-(l+b)-1),o=o.limit(u+b-1,u+w-(m+b)-1)):(n=Math.round(e+(g-l)/2-1),o=p=="above"?f-m+1:f+h-1,n=n.limit(t+b-1,t+v-(l+b)-1)),m>b*2&&(p=="before"||p=="after"?(z=f+h/2-1-o,z=Math.min(m-(c?c.getSize().y:b)-10,z),z=Math.max(b,z),z+o-1!=j&&(o-=o+z-j),x.top=z):(y=(e+g/2-1-n).limit(b,l-b),y+l-1!=i&&(n-=n+y-i),x.left=y)),a?(this.element.setStyles({left:n,top:o}),this.arrow.setStyles(x)):(this.element.morph({left:n,top:o}),this.arrow.morph(x))}}),Brickrouge.Popover.from=function(a){var b,c=a.title,d=a.content,e=a.actions,f=new Element("div.popover-inner");return c&&f.adopt(new Element("h3.popover-title",{html:c})),typeOf(d)=="element"?f.adopt((new Element("div.popover-content")).adopt(d)):f.adopt(new Element("div.popover-content",{html:d})),e=="boolean"&&(e=[new Element('button.cancel[data-action="cancel"]',{html:"Cancel"}),new Element('button.primary[data-action="ok"]',{html:"Ok"})]),e&&f.adopt((new Element("div.popover-actions")).adopt(e)),b=(new Element("div.popover")).adopt([new Element("div.arrow"),f]),new Brickrouge.Popover(b,a)},Brickrouge.Widget.Popover=Brickrouge.Popover,document.id(document.body).addEvents({'mouseenter:relay([rel="popover"])':function(a,b){var c,d;c=b.retrieve("popover"),c||(d=b.get("dataset"),d.anchor=b,c=Brickrouge.Popover.from(d),document.body.appendChild(c.element),b.store("popover",c)),c.show()},'mouseleave:relay([rel="popover"])':function(a,b){var c=b.retrieve("popover");if(!c)return;c.hide()}}),Brickrouge.Widget.Searchbox=new Class({Implements:Brickrouge.Utils.Busy,initialize:function(a,b){this.element=document.id(a)}})